{"title":"nginx的localtion配置","slug":"nginx的localtion配置","date":"2021-05-13T02:13:35.000Z","updated":"2022-01-05T09:29:11.610Z","comments":true,"path":"api/articles/nginx的localtion配置.json","excerpt":null,"covers":["https://7.dusays.com/2021/05/13/1128409d75ed2.png"],"content":"<p><img src=\"https://7.dusays.com/2021/05/13/1128409d75ed2.png\" alt=\"nginx\"></p>\n<h2 id=\"location-的作用\"><a href=\"#location-的作用\" class=\"headerlink\" title=\"location 的作用\"></a>location 的作用</h2><p>location 指令的作用是根据用户请求 URI 来执行不同的应用，location 会根据用户请求网站 URL 进行匹配定位到某个 location 区块。 如果匹配成功将会处理 location 块的规则。</p>\n<h2 id=\"语法规则\"><a href=\"#语法规则\" class=\"headerlink\" title=\"语法规则\"></a>语法规则</h2><pre class=\" language-js\"><code class=\"language-js\">location  <span class=\"token operator\">=</span>     <span class=\"token operator\">/</span>uri\n   ┬      ┬       ┬\n   │      │       │\n   │      │       │\n   │      │       │\n   │      │       │\n   │      │       └─────────────── 前缀<span class=\"token operator\">|</span>正则\n   │      └──────────────────── 可选的修饰符（用于匹配模式及优先级）\n   └───────────────────────── 必须\n</code></pre>\n<h2 id=\"修饰符说明\"><a href=\"#修饰符说明\" class=\"headerlink\" title=\"修饰符说明\"></a>修饰符说明</h2><p>以下从上到下，第一个优先级最高</p>\n<pre class=\" language-js\"><code class=\"language-js\"><span class=\"token operator\">=</span>      <span class=\"token operator\">|</span>   location <span class=\"token operator\">=</span> <span class=\"token operator\">/</span>uri\n<span class=\"token operator\">^</span><span class=\"token operator\">~</span>     <span class=\"token operator\">|</span>   location <span class=\"token operator\">^</span><span class=\"token operator\">~</span> <span class=\"token operator\">/</span>uri\n<span class=\"token operator\">~</span>      <span class=\"token operator\">|</span>   location <span class=\"token operator\">~</span> pattern\n<span class=\"token operator\">~</span><span class=\"token operator\">*</span>     <span class=\"token operator\">|</span>   location <span class=\"token operator\">~</span><span class=\"token operator\">*</span> pattern\n<span class=\"token operator\">/</span>uri   <span class=\"token operator\">|</span>   location <span class=\"token operator\">/</span>uri\n@      <span class=\"token operator\">|</span>   location @err</code></pre>\n<h2 id=\"优先级顺序\"><a href=\"#优先级顺序\" class=\"headerlink\" title=\"优先级顺序\"></a>优先级顺序</h2><p><em>优先级不分编辑 location 前后顺序</em></p>\n<ol>\n<li>= ，精确匹配，表示严格相等</li>\n</ol>\n<pre class=\" language-js\"><code class=\"language-js\">location <span class=\"token operator\">=</span> <span class=\"token operator\">/</span><span class=\"token keyword\">static</span> <span class=\"token punctuation\">{</span>\n  default_type text<span class=\"token operator\">/</span>html<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">200</span> <span class=\"token string\">\"hello world\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span><span class=\"token keyword\">static</span>   <span class=\"token punctuation\">[</span>成功<span class=\"token punctuation\">]</span>\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span>Static   <span class=\"token punctuation\">[</span>失败<span class=\"token punctuation\">]</span>\n</code></pre>\n<ol start=\"2\">\n<li>^~ ，匹配以 URI 开头</li>\n</ol>\n<pre class=\" language-js\"><code class=\"language-js\">\nlocation <span class=\"token operator\">^</span><span class=\"token operator\">~</span> <span class=\"token operator\">/</span><span class=\"token keyword\">static</span> <span class=\"token punctuation\">{</span>\n  default_type text<span class=\"token operator\">/</span>html<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">200</span> <span class=\"token string\">\"hello world\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span><span class=\"token keyword\">static</span><span class=\"token operator\">/</span><span class=\"token number\">1</span><span class=\"token punctuation\">.</span>txt    <span class=\"token punctuation\">[</span>成功<span class=\"token punctuation\">]</span>\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span><span class=\"token keyword\">public</span><span class=\"token operator\">/</span><span class=\"token number\">1</span><span class=\"token punctuation\">.</span>txt    <span class=\"token punctuation\">[</span>失败<span class=\"token punctuation\">]</span></code></pre>\n<ol start=\"3\">\n<li>~ ，对大小写敏感, 使用正则 注意：某些操作系统对大小写敏感是不生效的，比如 windows 操作系统</li>\n</ol>\n<pre class=\" language-js\"><code class=\"language-js\">location <span class=\"token operator\">~</span> <span class=\"token operator\">^</span><span class=\"token operator\">/</span><span class=\"token keyword\">static</span>$ <span class=\"token punctuation\">{</span>\n  default_type text<span class=\"token operator\">/</span>html<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">200</span> <span class=\"token string\">\"hello world\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span><span class=\"token keyword\">static</span>         <span class=\"token punctuation\">[</span>成功<span class=\"token punctuation\">]</span>\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span><span class=\"token keyword\">static</span><span class=\"token operator\">?</span>v<span class=\"token operator\">=</span><span class=\"token number\">1</span>     <span class=\"token punctuation\">[</span>成功<span class=\"token punctuation\">]</span> 忽略查询字符串\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span>STATic         <span class=\"token punctuation\">[</span>失败<span class=\"token punctuation\">]</span>\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span><span class=\"token keyword\">static</span><span class=\"token operator\">/</span>        <span class=\"token punctuation\">[</span>失败<span class=\"token punctuation\">]</span> 多了斜杠\n</code></pre>\n<ol start=\"4\">\n<li><del>* ，与</del>相反，忽略大小写敏感, 使用正则</li>\n</ol>\n<pre class=\" language-js\"><code class=\"language-js\">location <span class=\"token operator\">~</span><span class=\"token operator\">*</span> <span class=\"token operator\">^</span><span class=\"token operator\">/</span><span class=\"token keyword\">static</span>$ <span class=\"token punctuation\">{</span>\n  default_type text<span class=\"token operator\">/</span>html<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">200</span> <span class=\"token string\">\"hello world\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span><span class=\"token keyword\">static</span>         <span class=\"token punctuation\">[</span>成功<span class=\"token punctuation\">]</span>\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span><span class=\"token keyword\">static</span><span class=\"token operator\">?</span>v<span class=\"token operator\">=</span><span class=\"token number\">1</span>     <span class=\"token punctuation\">[</span>成功<span class=\"token punctuation\">]</span> 忽略查询字符串\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span>STATic         <span class=\"token punctuation\">[</span>成功<span class=\"token punctuation\">]</span>\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span><span class=\"token keyword\">static</span><span class=\"token operator\">/</span>        <span class=\"token punctuation\">[</span>失败<span class=\"token punctuation\">]</span> 多了斜杠\n</code></pre>\n<ol start=\"5\">\n<li>/uri ，匹配以/uri 开头的地址</li>\n</ol>\n<pre class=\" language-js\"><code class=\"language-js\">location  <span class=\"token operator\">/</span><span class=\"token keyword\">static</span> <span class=\"token punctuation\">{</span>\n  default_type text<span class=\"token operator\">/</span>html<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">200</span> <span class=\"token string\">\"hello world\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span><span class=\"token keyword\">static</span>              <span class=\"token punctuation\">[</span>成功<span class=\"token punctuation\">]</span>\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span>STATIC<span class=\"token operator\">?</span>v<span class=\"token operator\">=</span><span class=\"token number\">1</span>          <span class=\"token punctuation\">[</span>成功<span class=\"token punctuation\">]</span>\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span><span class=\"token keyword\">static</span><span class=\"token operator\">/</span><span class=\"token number\">1</span>            <span class=\"token punctuation\">[</span>成功<span class=\"token punctuation\">]</span>\n# http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span><span class=\"token keyword\">static</span><span class=\"token operator\">/</span><span class=\"token number\">1</span><span class=\"token punctuation\">.</span>txt        <span class=\"token punctuation\">[</span>成功<span class=\"token punctuation\">]</span>\n</code></pre>\n<ol start=\"6\">\n<li>@ 用于定义一个 Location 块，且该块不能被外部 Client 所访问，只能被 nginx 内部配置指令所访问，比如 try_files or error_page</li>\n</ol>\n<pre class=\" language-js\"><code class=\"language-js\">location  <span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n  root   <span class=\"token regex\">/root/</span><span class=\"token punctuation\">;</span>\n  error_page <span class=\"token number\">404</span> @err<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nlocation  @err <span class=\"token punctuation\">{</span>\n  # 规则\n  default_type text<span class=\"token operator\">/</span>html<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token number\">200</span> <span class=\"token string\">\"err\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n# 如果 http<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost<span class=\"token operator\">/</span><span class=\"token number\">1</span><span class=\"token punctuation\">.</span>txt <span class=\"token number\">404</span>，将会跳转到@err并输出err\n</code></pre>\n","more":"<p><img src=\"https://7.dusays.com/2021/05/13/1128409d75ed2.png\" alt=\"nginx\"></p>\n<h2 id=\"location-的作用\"><a href=\"#location-的作用\" class=\"headerlink\" title=\"location 的作用\"></a>location 的作用</h2><p>location 指令的作用是根据用户请求 URI 来执行不同的应用，location 会根据用户请求网站 URL 进行匹配定位到某个 location 区块。 如果匹配成功将会处理 location 块的规则。</p>\n<h2 id=\"语法规则\"><a href=\"#语法规则\" class=\"headerlink\" title=\"语法规则\"></a>语法规则</h2><pre><code class=\"js\">location  =     /uri\n   ┬      ┬       ┬\n   │      │       │\n   │      │       │\n   │      │       │\n   │      │       │\n   │      │       └─────────────── 前缀|正则\n   │      └──────────────────── 可选的修饰符（用于匹配模式及优先级）\n   └───────────────────────── 必须\n</code></pre>\n<h2 id=\"修饰符说明\"><a href=\"#修饰符说明\" class=\"headerlink\" title=\"修饰符说明\"></a>修饰符说明</h2><p>以下从上到下，第一个优先级最高</p>\n<pre><code class=\"js\">=      |   location = /uri\n^~     |   location ^~ /uri\n~      |   location ~ pattern\n~*     |   location ~* pattern\n/uri   |   location /uri\n@      |   location @err</code></pre>\n<h2 id=\"优先级顺序\"><a href=\"#优先级顺序\" class=\"headerlink\" title=\"优先级顺序\"></a>优先级顺序</h2><p><em>优先级不分编辑 location 前后顺序</em></p>\n<ol>\n<li>= ，精确匹配，表示严格相等</li>\n</ol>\n<pre><code class=\"js\">location = /static &#123;\n  default_type text/html;\n  return 200 &quot;hello world&quot;;\n&#125;\n\n# http://localhost/static   [成功]\n# http://localhost/Static   [失败]\n</code></pre>\n<ol start=\"2\">\n<li>^~ ，匹配以 URI 开头</li>\n</ol>\n<pre><code class=\"js\">\nlocation ^~ /static &#123;\n  default_type text/html;\n  return 200 &quot;hello world&quot;;\n&#125;\n\n\n# http://localhost/static/1.txt    [成功]\n# http://localhost/public/1.txt    [失败]</code></pre>\n<ol start=\"3\">\n<li>~ ，对大小写敏感, 使用正则 注意：某些操作系统对大小写敏感是不生效的，比如 windows 操作系统</li>\n</ol>\n<pre><code class=\"js\">location ~ ^/static$ &#123;\n  default_type text/html;\n  return 200 &quot;hello world&quot;;\n&#125;\n\n# http://localhost/static         [成功]\n# http://localhost/static?v=1     [成功] 忽略查询字符串\n# http://localhost/STATic         [失败]\n# http://localhost/static/        [失败] 多了斜杠\n</code></pre>\n<ol start=\"4\">\n<li><del>* ，与</del>相反，忽略大小写敏感, 使用正则</li>\n</ol>\n<pre><code class=\"js\">location ~* ^/static$ &#123;\n  default_type text/html;\n  return 200 &quot;hello world&quot;;\n&#125;\n\n# http://localhost/static         [成功]\n# http://localhost/static?v=1     [成功] 忽略查询字符串\n# http://localhost/STATic         [成功]\n# http://localhost/static/        [失败] 多了斜杠\n</code></pre>\n<ol start=\"5\">\n<li>/uri ，匹配以/uri 开头的地址</li>\n</ol>\n<pre><code class=\"js\">location  /static &#123;\n  default_type text/html;\n  return 200 &quot;hello world&quot;;\n&#125;\n\n# http://localhost/static              [成功]\n# http://localhost/STATIC?v=1          [成功]\n# http://localhost/static/1            [成功]\n# http://localhost/static/1.txt        [成功]\n</code></pre>\n<ol start=\"6\">\n<li>@ 用于定义一个 Location 块，且该块不能被外部 Client 所访问，只能被 nginx 内部配置指令所访问，比如 try_files or error_page</li>\n</ol>\n<pre><code class=\"js\">location  / &#123;\n  root   /root/;\n  error_page 404 @err;\n&#125;\nlocation  @err &#123;\n  # 规则\n  default_type text/html;\n  return 200 &quot;err&quot;;\n&#125;\n\n# 如果 http://localhost/1.txt 404，将会跳转到@err并输出err\n</code></pre>\n","categories":[{"name":"nginx专题","path":"api/categories/nginx专题.json"}],"tags":[{"name":"nginx","path":"api/tags/nginx.json"}]}