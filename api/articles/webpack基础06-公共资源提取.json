{"title":"webpack基础06-公共资源提取","slug":"webpack基础06-公共资源提取","date":"2021-01-17T03:14:15.000Z","updated":"2022-01-05T09:30:52.953Z","comments":true,"path":"api/articles/webpack基础06-公共资源提取.json","excerpt":null,"covers":["https://7.dusays.com/2021/01/18/729f3fe8cc21d.png"],"content":"<h2 id=\"基础库分离：React示例\"><a href=\"#基础库分离：React示例\" class=\"headerlink\" title=\"基础库分离：React示例\"></a>基础库分离：React示例</h2><p>思路：将react、react-dom 基础包通过cdn引入，不打入bundle</p>\n<h3 id=\"使用html-webpack-extends-plugin\"><a href=\"#使用html-webpack-extends-plugin\" class=\"headerlink\" title=\"使用html-webpack-extends-plugin\"></a>使用html-webpack-extends-plugin</h3><pre class=\" language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> HtmlWebpackExternalsPlugin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html-webpack-externals-plugin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nplugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackExternalsPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        externals<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            module<span class=\"token punctuation\">:</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">,</span>\n            entry<span class=\"token punctuation\">:</span> <span class=\"token string\">'https://11.url.cn/now/lib/16.2.0/react.min.js'</span><span class=\"token punctuation\">,</span>\n            global<span class=\"token punctuation\">:</span> <span class=\"token string\">'React'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n            module<span class=\"token punctuation\">:</span> <span class=\"token string\">'react-dom'</span><span class=\"token punctuation\">,</span>\n            entry<span class=\"token punctuation\">:</span> <span class=\"token string\">'https://11.url.cn/now/lib/16.2.0/react-dom.min.js'</span><span class=\"token punctuation\">,</span>\n            global<span class=\"token punctuation\">:</span> <span class=\"token string\">'ReactDOM'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span>\n</code></pre>\n<p>效果如图 </p>\n<p><img src=\"https://7.dusays.com/2021/01/18/729f3fe8cc21d.png\" alt=\"image\"></p>\n<h3 id=\"使用-SplitChunksPlugin-进行公共脚本分离\"><a href=\"#使用-SplitChunksPlugin-进行公共脚本分离\" class=\"headerlink\" title=\"使用 SplitChunksPlugin 进行公共脚本分离\"></a>使用 SplitChunksPlugin 进行公共脚本分离</h3><p>webpack4 内置的，替代 CommonsChunkPlugin（webpack3使用的多） 插件，SplitChunksPlugin介绍请参考官方文档</p>\n<p>chunks参数说明：</p>\n<ul>\n<li>async: 异步引入的库进行分离（默认）</li>\n<li>initial: 同步引入的库进行分离</li>\n<li>all: 所以引入的库进行分离（推荐）</li>\n</ul>\n<pre class=\" language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\" spellcheck=\"true\">//...</span>\n  optimization<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    splitChunks<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      chunks<span class=\"token punctuation\">:</span> <span class=\"token string\">'async'</span><span class=\"token punctuation\">,</span>\n      minSize<span class=\"token punctuation\">:</span> <span class=\"token number\">30000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\" spellcheck=\"true\">// 分离包体积的大小</span>\n      maxSize<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      minChunks<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>    <span class=\"token comment\" spellcheck=\"true\">// 设置最小引用次数为2次</span>\n      maxAsyncRequests<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>  \n      maxInitialRequests<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n      automaticNameDelimiter<span class=\"token punctuation\">:</span> <span class=\"token string\">'~'</span><span class=\"token punctuation\">,</span>\n      automaticNameMaxLength<span class=\"token punctuation\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      cacheGroups<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        vendors<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/[\\\\/]node_modules[\\\\/]/</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\" spellcheck=\"true\">// 匹配出需要分离的包</span>\n          priority<span class=\"token punctuation\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">10</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          minChunks<span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n          priority<span class=\"token punctuation\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n          reuseExistingChunk<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\" spellcheck=\"true\">//三方库分离</span>\n optimization<span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>\n        splitChunks<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            cacheGroups<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n                commons<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n                    test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/(react|react-dom)/</span><span class=\"token punctuation\">,</span>\n                    name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"vendors\"</span><span class=\"token punctuation\">,</span>\n                    chunks<span class=\"token punctuation\">:</span> <span class=\"token string\">\"all\"</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token comment\" spellcheck=\"true\">//公共脚本分离</span>\n optimization<span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>\n        splitChunks<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            minSize<span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n            cacheGroups<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n                commons<span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>\n                    name<span class=\"token punctuation\">:</span><span class=\"token string\">'commons'</span><span class=\"token punctuation\">,</span>\n                    chunks<span class=\"token punctuation\">:</span><span class=\"token string\">\"all\"</span><span class=\"token punctuation\">,</span>\n                    minChunks<span class=\"token punctuation\">:</span><span class=\"token number\">2</span> <span class=\"token comment\" spellcheck=\"true\">//至少引用2次，才打包出commons文件</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>引入方法</p>\n<pre class=\" language-js\"><code class=\"language-js\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">HTMLWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  chunks<span class=\"token punctuation\">:</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"vendors\"</span><span class=\"token punctuation\">,</span>pageName<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n","more":"<h2 id=\"基础库分离：React示例\"><a href=\"#基础库分离：React示例\" class=\"headerlink\" title=\"基础库分离：React示例\"></a>基础库分离：React示例</h2><p>思路：将react、react-dom 基础包通过cdn引入，不打入bundle</p>\n<h3 id=\"使用html-webpack-extends-plugin\"><a href=\"#使用html-webpack-extends-plugin\" class=\"headerlink\" title=\"使用html-webpack-extends-plugin\"></a>使用html-webpack-extends-plugin</h3><pre><code class=\"js\">const HtmlWebpackExternalsPlugin = require(&#39;html-webpack-externals-plugin&#39;);\nplugins: [\n    new HtmlWebpackExternalsPlugin(&#123;\n        externals: [\n          &#123;\n            module: &#39;react&#39;,\n            entry: &#39;https://11.url.cn/now/lib/16.2.0/react.min.js&#39;,\n            global: &#39;React&#39;,\n          &#125;,\n          &#123;\n            module: &#39;react-dom&#39;,\n            entry: &#39;https://11.url.cn/now/lib/16.2.0/react-dom.min.js&#39;,\n            global: &#39;ReactDOM&#39;,\n          &#125;,\n        ]\n    &#125;),\n]\n</code></pre>\n<p>效果如图 </p>\n<p><img src=\"https://7.dusays.com/2021/01/18/729f3fe8cc21d.png\" alt=\"image\"></p>\n<h3 id=\"使用-SplitChunksPlugin-进行公共脚本分离\"><a href=\"#使用-SplitChunksPlugin-进行公共脚本分离\" class=\"headerlink\" title=\"使用 SplitChunksPlugin 进行公共脚本分离\"></a>使用 SplitChunksPlugin 进行公共脚本分离</h3><p>webpack4 内置的，替代 CommonsChunkPlugin（webpack3使用的多） 插件，SplitChunksPlugin介绍请参考官方文档</p>\n<p>chunks参数说明：</p>\n<ul>\n<li>async: 异步引入的库进行分离（默认）</li>\n<li>initial: 同步引入的库进行分离</li>\n<li>all: 所以引入的库进行分离（推荐）</li>\n</ul>\n<pre><code class=\"js\">module.exports = &#123;\n  //...\n  optimization: &#123;\n    splitChunks: &#123;\n      chunks: &#39;async&#39;,\n      minSize: 30000, // 分离包体积的大小\n      maxSize: 0,\n      minChunks: 2,    // 设置最小引用次数为2次\n      maxAsyncRequests: 5,  \n      maxInitialRequests: 3,\n      automaticNameDelimiter: &#39;~&#39;,\n      automaticNameMaxLength: 30,\n      name: true,\n      cacheGroups: &#123;\n        vendors: &#123;\n          test: /[\\\\/]node_modules[\\\\/]/,  // 匹配出需要分离的包\n          priority: -10\n        &#125;,\n        default: &#123;\n          minChunks: 2,\n          priority: -20,\n          reuseExistingChunk: true\n        &#125;\n      &#125;\n    &#125;\n  &#125;\n\n  //三方库分离\n optimization:&#123;\n        splitChunks: &#123;\n            cacheGroups: &#123;\n                commons: &#123;\n                    test: /(react|react-dom)/,\n                    name: &quot;vendors&quot;,\n                    chunks: &quot;all&quot;\n                &#125;\n            &#125;\n        &#125;\n    &#125;\n//公共脚本分离\n optimization:&#123;\n        splitChunks: &#123;\n            minSize:0,\n            cacheGroups: &#123;\n                commons:&#123;\n                    name:&#39;commons&#39;,\n                    chunks:&quot;all&quot;,\n                    minChunks:2 //至少引用2次，才打包出commons文件\n                &#125;\n            &#125;\n        &#125;\n    &#125;\n&#125;;</code></pre>\n<p>引入方法</p>\n<pre><code class=\"js\">new HTMLWebpackPlugin(&#123;\n  chunks:[&quot;vendors&quot;,pageName]\n&#125;)</code></pre>\n","categories":[{"name":"webpack专区","path":"api/categories/webpack专区.json"}],"tags":[{"name":"webpack","path":"api/tags/webpack.json"}]}